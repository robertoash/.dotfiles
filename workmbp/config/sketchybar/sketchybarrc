#!/bin/bash

# SketchyBar configuration - visually improved and aligned with Hammerspoon
# Matches Hammerspoon window padding: top=43px, sides=8px

PLUGIN_DIR="$HOME/.config/sketchybar/plugins"

# ============================================================================
# Color Scheme
# ============================================================================
COLOR_BG="0xff010111"          # Main background (very dark - #010111)
COLOR_ITEM_BG="0xff313244"     # Item background (slightly lighter)
COLOR_TEXT="0xffffffff"        # White text
COLOR_ICON="0xffffffff"        # White icons
COLOR_ACCENT="0xff7aa2f7"      # Blue accent
COLOR_BORDER="0xff82aaff"      # Blue border color (color12 - #82aaff)
COLOR_SEPARATOR="0xff6c7086"   # Grey separator (more visible)
COLOR_TRANSPARENT="0x00000000" # Transparent

# ============================================================================
# Bar Appearance
# ============================================================================
# Match Hammerspoon padding: top=43px, left=8px, right=8px
# y_offset=4 gives 4px top margin (50% of side margins)
sketchybar --bar position=top \
                 height=35 \
                 blur_radius=30 \
                 padding_left=0 \
                 padding_right=0 \
                 margin=8 \
                 y_offset=4 \
                 corner_radius=10 \
                 color=$COLOR_TRANSPARENT

# ============================================================================
# Default Item Settings
# ============================================================================
sketchybar --default icon.font="GeistMono NF:Regular:14.0" \
                     icon.color=$COLOR_ICON \
                     icon.padding_left=4 \
                     icon.padding_right=4 \
                     label.font="GeistMono NF:Regular:14.0" \
                     label.color=$COLOR_TEXT \
                     label.padding_left=4 \
                     label.padding_right=4 \
                     padding_left=6 \
                     padding_right=6

# ============================================================================
# LEFT SIDE - Workspaces & System Info
# ============================================================================

# Workspaces (1-10)
SPACE_ICONS=("1" "2" "3" "4" "5" "6" "7" "8" "9" "10")
for i in "${!SPACE_ICONS[@]}"
do
  sid=$(($i+1))
  sketchybar --add space space.$sid left \
             --set space.$sid associated_space=$sid \
                              icon=${SPACE_ICONS[i]} \
                              icon.font="GeistMono NF:Bold:14.0" \
                              icon.padding_left=8 \
                              icon.padding_right=8 \
                              padding_right=0 \
                              icon.highlight_color=0xff7aa2f7 \
                              background.color=0xff363a4f \
                              background.corner_radius=6 \
                              background.height=22 \
                              background.drawing=off \
                              label.padding_left=5 \
                              label.drawing=off \
                              script="$PLUGIN_DIR/space.sh" \
                              click_script="$PLUGIN_DIR/space_click.sh $sid" \
             --subscribe space.$sid space_change mouse.clicked
done

# Divider after workspaces
sketchybar --add item space_separator left \
           --set space_separator icon="" \
                                 label="│" \
                                 label.font="GeistMono NF:Regular:16.0" \
                                 label.color=$COLOR_SEPARATOR \
                                 padding_left=0 \
                                 padding_right=0 \
                                 icon.drawing=off

# CPU (icon + label)
sketchybar --add item cpu left \
           --set cpu update_freq=2 \
                     icon=󰍛 \
                     icon.color=$COLOR_ACCENT \
                     padding_left=6 \
                     padding_right=-2 \
                     icon.padding_left=2 \
                     icon.padding_right=2 \
                     label.padding_left=1 \
                     label.padding_right=2 \
                     label.width=30 \
                     script="$PLUGIN_DIR/cpu.sh"

# Divider between CPU and Memory
sketchybar --add item cpu_memory_separator left \
           --set cpu_memory_separator icon="" \
                                      label="│" \
                                      label.font="GeistMono NF:Regular:16.0" \
                                      label.color=$COLOR_SEPARATOR \
                                      padding_left=0 \
                                      padding_right=0 \
                                      icon.drawing=off

# Memory (icon + label)
sketchybar --add item memory left \
           --set memory update_freq=10 \
                        icon=󰘚 \
                        icon.color=$COLOR_ACCENT \
                        padding_left=6 \
                        padding_right=4 \
                        icon.padding_left=2 \
                        icon.padding_right=2 \
                        label.padding_left=1 \
                        label.padding_right=8 \
                        script="$PLUGIN_DIR/memory.sh"

# ============================================================================
# CENTER - Active Window
# ============================================================================
# sketchybar --add item front_app center \
#            --set front_app icon.drawing=off \
#                           label.font="GeistMono NF:SemiBold:14.0" \
#                           script="$PLUGIN_DIR/front_app.sh" \
#            --subscribe front_app front_app_switched

# ============================================================================
# RIGHT SIDE - System Status
# ============================================================================

# Local Clock (with seconds) - FAR RIGHT (icon + label)
sketchybar --add item clock right \
           --set clock update_freq=1 \
                       icon= \
                       icon.color=$COLOR_ACCENT \
                       padding_left=6 \
                       padding_right=4 \
                       icon.padding_left=2 \
                       icon.padding_right=2 \
                       label.padding_left=1 \
                       label.padding_right=8 \
                       script="$PLUGIN_DIR/clock.sh"

# Divider 1
sketchybar --add item separator.r1 right \
           --set separator.r1 icon="" \
                             label="│" \
                             label.font="GeistMono NF:Regular:16.0" \
                             label.color=$COLOR_SEPARATOR \
                             padding_left=0 \
                             padding_right=0 \
                             icon.drawing=off

# Battery (icon + label)
sketchybar --add item battery right \
           --set battery update_freq=60 \
                          icon.color=$COLOR_ACCENT \
                          padding_left=6 \
                          padding_right=-2 \
                          icon.padding_left=2 \
                          icon.padding_right=2 \
                          label.padding_left=1 \
                          label.padding_right=2 \
                          script="$PLUGIN_DIR/battery.sh"

# Divider 2
sketchybar --add item separator.r2 right \
           --set separator.r2 icon="" \
                             label="│" \
                             label.font="GeistMono NF:Regular:16.0" \
                             label.color=$COLOR_SEPARATOR \
                             padding_left=0 \
                             padding_right=0 \
                             icon.drawing=off

# Network (icon only)
sketchybar --add item network right \
           --set network update_freq=1 \
                         label.drawing=off \
                         icon.color=$COLOR_ACCENT \
                         padding_left=8 \
                         padding_right=-2 \
                         icon.padding_left=0 \
                         icon.padding_right=0 \
                         script="$PLUGIN_DIR/network.sh"

# Divider 3
sketchybar --add item separator.r3 right \
           --set separator.r3 icon="" \
                             label="│" \
                             label.font="GeistMono NF:Regular:16.0" \
                             label.color=$COLOR_SEPARATOR \
                             padding_left=0 \
                             padding_right=0 \
                             icon.drawing=off

# Bluetooth (icon only)
sketchybar --add item bluetooth right \
           --set bluetooth update_freq=5 \
                          label.drawing=off \
                          icon.color=$COLOR_ACCENT \
                          padding_left=8 \
                          padding_right=-2 \
                          icon.padding_left=0 \
                          icon.padding_right=0 \
                          script="$PLUGIN_DIR/bluetooth.sh" \
                          click_script="open /System/Library/PreferencePanes/Bluetooth.prefPane"

# Divider 4
sketchybar --add item separator.r4 right \
           --set separator.r4 icon="" \
                             label="│" \
                             label.font="GeistMono NF:Regular:16.0" \
                             label.color=$COLOR_SEPARATOR \
                             padding_left=0 \
                             padding_right=0 \
                             icon.drawing=off

# Volume (icon + label)
sketchybar --add item volume right \
           --set volume icon.color=$COLOR_ACCENT \
                       padding_left=6 \
                       padding_right=-2 \
                       icon.padding_left=2 \
                       icon.padding_right=2 \
                       label.padding_left=1 \
                       label.padding_right=2 \
                       script="$PLUGIN_DIR/volume.sh" \
           --subscribe volume volume_change

# Divider 5
sketchybar --add item separator.r5 right \
           --set separator.r5 icon="" \
                             label="│" \
                             label.font="GeistMono NF:Regular:16.0" \
                             label.color=$COLOR_SEPARATOR \
                             padding_left=0 \
                             padding_right=0 \
                             icon.drawing=off

# El Salvador Clock - FAR LEFT (icon + label)
sketchybar --add item clock.sal right \
           --set clock.sal update_freq=60 \
                          icon=󰥔 \
                          icon.color=$COLOR_ACCENT \
                          padding_left=12 \
                          padding_right=-2 \
                          icon.padding_left=2 \
                          icon.padding_right=2 \
                          label.padding_left=1 \
                          label.padding_right=2 \
                          script="$PLUGIN_DIR/clock_sal.sh"

# ============================================================================
# BRACKETS - Grouped Items with Backgrounds
# ============================================================================

# LEFT GROUP - Workspaces & System Info
sketchybar --add bracket left_group \
              space.1 space.2 space.3 space.4 space.5 \
              space.6 space.7 space.8 space.9 space.10 \
              space_separator cpu cpu_memory_separator memory \
           --set left_group \
              background.color=$COLOR_BG \
              background.corner_radius=10 \
              background.height=35 \
              background.padding_left=12 \
              background.padding_right=12 \
              background.border_color=$COLOR_BORDER \
              background.border_width=3 \
              background.drawing=on

# CENTER GROUP - Active Window (hidden)
# sketchybar --add bracket center_group front_app \
#            --set center_group \
#               background.drawing=off

# RIGHT GROUP - System Status
sketchybar --add bracket right_group \
              clock.sal separator.r5 volume separator.r4 bluetooth \
              separator.r3 network separator.r2 battery separator.r1 clock \
           --set right_group \
              background.color=$COLOR_BG \
              background.corner_radius=10 \
              background.height=35 \
              background.padding_left=12 \
              background.padding_right=12 \
              background.border_color=$COLOR_BORDER \
              background.border_width=3 \
              background.drawing=on

# ============================================================================
# Finalize
# ============================================================================
sketchybar --update
