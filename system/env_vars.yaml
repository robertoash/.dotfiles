# Single source of truth for ALL environment variables
# Distribution: setup.py reads this and generates appropriate config files
#
# Scopes:
#   global: Available everywhere via systemd user environment
#   hyprland_only: Only set in Hyprland config (Wayland/WM-specific)
#   shell_only: Only for interactive shells (not needed system-wide)
#   machines: Machine-specific overrides and additions

# ==============================================================================
# GLOBAL - Available everywhere via systemd user environment
# ==============================================================================
global:
  # Editors
  EDITOR: nvim
  VISUAL: nvim
  GIT_EDITOR: nvim
  SUDO_EDITOR: nvim
  IDE: cursor
  NOTE_EDITOR: obsidian
  TERMINAL: wezterm


  # Terminal
  COLORTERM: truecolor
  # NOTE: TERM is set by terminal emulator itself, don't override

  # Paths
  PATH: $PATH:$HOME/.local/bin:$HOME/go/bin:$HOME/.cargo/bin

  # Application configs
  GTK2_RC_FILES: $HOME/.config/gtk-2.0/gtkrc-2.0
  GTK_THEME: tokyonight_deep
  RIPGREP_CONFIG_PATH: $HOME/.config/rg/.ripgreprc
  STARSHIP_CONFIG: $HOME/.config/starship/starship.toml
  TASKDATA: $HOME/.config/task/.task
  TASKRC: $HOME/.config/task/taskrc
  YARN_RC_FILENAME: $HOME/.config/yarn/.yarnrc
  ZELLIJ_CONFIG_FILE: $HOME/.config/zellij/config.kdl

  # FZF
  FD_IGNORE_FILE: $HOME/.config/fd/ignore

  # Tool settings
  DOCKER_BUILDKIT: "1"
  WALK_MAIN_COLOR: "#010111"
  WALK_REMOVE_CMD: trash

  # Development
  CURRENT_PROJECT_DIR: /home/rash/dev/apps
  DOTFILES_DIR: /home/rash/.config

  # Services
  LINKDING_URL: https://links.rashlab.net

  # Claude Code
  CLAUDE_CODE_DISABLE_NONESSENTIAL_TRAFFIC: "true"

  # Serena
  SERENA_HOME: /home/rash/.config/serena

  # Thoth
  THOTH_NOTES_DIR: ~/thoth

# ==============================================================================
# HYPRLAND ONLY - Set only in Hyprland config (not via systemd)
# ==============================================================================
hyprland_only:
  # Session/Display
  XDG_SESSION_TYPE: wayland
  XDG_CURRENT_DESKTOP: Hyprland
  XDG_SESSION_DESKTOP: Hyprland

  # Cursor (Hyprland-specific)
  XCURSOR_THEME: Bibata-Modern-Classic
  XCURSOR_SIZE: "24"

  # GUI toolkit backends for Wayland
  QT_QPA_PLATFORM: wayland
  QT_QPA_PLATFORMTHEME: gtk2
  GDK_BACKEND: wayland,x11
  SDL_VIDEODRIVER: wayland
  CLUTTER_BACKEND: wayland
  MOZ_ENABLE_WAYLAND: "1"
  ELECTRON_OZONE_PLATFORM_HINT: auto

  # D-Bus (critical for GUI apps)
  DBUS_SESSION_BUS_ADDRESS: unix:path=/run/user/1000/bus

  # Keyboard layout (dynamically updated by kanata_layer_switcher.py)
  KEYBOARD_LAYOUT: swe

# ==============================================================================
# SHELL ONLY - Interactive shell variables (not needed system-wide)
# ==============================================================================
shell_only:
  # Applications
  BROWSER: /home/rash/.local/bin/qute_profile rash %s
  BROWSER_CLEAN: /home/rash/.local/bin/qute_profile rash
  
  # FZF
  FZF_DEFAULT_COMMAND: fd .
  
  # Walk file manager
  WALK_STATUS_BAR: Size() + ' ' + Mode()
  
  # Terminal
  TERM_PROGRAM: WezTerm
  
  # PYTHONPATH is set per-machine in shell config due to machine-specific paths

# ==============================================================================
# MACHINE-SPECIFIC - Overrides and additions per machine
# ==============================================================================
machines:
  linuxmini:
    # Python path for linuxmini scripts
    PYTHONPATH: $HOME/.dotfiles/linuxmini/scripts

  workmbp:
    # Homebrew paths (prepended to global PATH by env_distribution.py)
    PATH: /opt/homebrew/bin:/opt/homebrew/sbin
    # Note: HOMEBREW_PREFIX, HOMEBREW_CELLAR, HOMEBREW_REPOSITORY, MANPATH, INFOPATH
    # are set dynamically by 00_homebrew.fish based on architecture

# ==============================================================================
# SECRETS - Names only (values from SOPS, loaded by shell)
# ==============================================================================
# These are documented here but loaded from $XDG_RUNTIME_DIR/secrets/ by shell config
# Do NOT put actual values here - they live in encrypted SOPS files

secrets:
  # Global secrets (loaded on all machines via common fish config)
  global:
    - HASS_SERVER              # Home Assistant server URL
    - HASS_TOKEN               # Home Assistant API token
    - TIBBER_TOKEN             # Tibber energy API token
    - SP_USER                  # Spotify username
    - SP_PASS                  # Spotify password
    - CJAR_OVEN                # Encrypted filesystem vars
    - CJAR_LAXATIVE            # Encrypted filesystem vars
    - DOUGH_STORAGE            # Encrypted filesystem vars
    - DINNER_TABLE             # Encrypted filesystem vars
    - OPENAI_API_KEY           # OpenAI API key
    - ANTHROPIC_API_KEY        # Anthropic/Claude API key
    - LINKDING_TOKEN           # Linkding bookmark manager token
    - GITHUB_PERSONAL_ACCESS_TOKEN  # GitHub PAT
    - OBSIDIAN_API_KEY         # Obsidian API key
    - RASH_GMAIL_PASS          # Gmail app password
    - CLAUDE_CODE_OAUTH_TOKEN  # Claude Code OAuth (SSH to workmbp only)

  # linuxmini-specific secrets
  linuxmini_only:
    - XTREAM_PROXY_SERVER      # IPTV proxy server (from xtream YAML)
    - XTREAM_PROXY_USERNAME    # IPTV proxy username
    - XTREAM_PROXY_PASSWORD    # IPTV proxy password

  # workmbp-specific secrets
  workmbp_only:
    - PRIVATE_KEY_PASSPHRASE   # SSH key passphrase
    - WORKMBP_SOPS_SECRETS_SET # Flag indicating secrets loaded
    - GITHUB_TOKEN             # Duplicate of GITHUB_PERSONAL_ACCESS_TOKEN
    - PGHOST                   # PostgreSQL/Redshift host
    - PGPORT                   # PostgreSQL/Redshift port
    - PGUSER                   # PostgreSQL/Redshift user
    - PGPASSWORD               # PostgreSQL/Redshift password

# ==============================================================================
# DISTRIBUTION TARGETS
# ==============================================================================
# This section defines where variables should be distributed to
# (used by setup.py for code generation)

distribution:
  systemd_environment:
    file: ~/.config/environment.d/env_vars.conf
    sources:
      - global
      - machines.{current_machine}  # Machine-specific overrides

  hyprland_config:
    file: ~/.dotfiles/{machine}/config/hypr/env.conf
    sources:
      - hyprland_only
      - PATH from global  # PATH needed early for app launching
    machines:
      - linuxmini

  fish_import:
    # Fish imports systemd environment + loads secrets
    # No direct distribution needed - handled by 00_environment.fish
    note: Fish loads from systemd via systemctl --user show-environment

  zsh_import:
    # Zsh should import systemd environment (similar to Fish)
    # TODO: Update .zshrc to import from systemd instead of duplicating
    note: Should load from systemd via systemctl --user show-environment
